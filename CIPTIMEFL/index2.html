<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Force Layout with labels on edges</title>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<style type="text/css">
</style>
</head>
<body>

<script type="text/javascript">

    var w = 1000;
    var h = 600;
    var linkDistance=200;

    var colors = d3.scale.category10();

    var dataset = { 
"nodes":[ 
 {"name":"CI_1","CI_OPERATOR":"Infrastructure_1","ci_sector":"Energy","ci_subsector":"A","init":true,"location_latitude":34.0,"location_longtitude":34.0,"maxPath":true,"substation_Name":"A","substation_id":"CI_1-1"},
 {"name":"CI_2","CI_OPERATOR":"Infrastructure_2","ci_sector":"Critical Manufacturing","ci_subsector":"B","init":false,"location_latitude":34.0,"location_longtitude":34.0,"maxPath":true,"substation_Name":"B","substation_id":"CI_2-2"},
 {"name":"CI_3","CI_OPERATOR":"Infrastructure_3","ci_sector":"Critical Manufacturing","ci_subsector":"C","init":false,"location_latitude":34.0,"location_longtitude":34.0,"maxPath":true,"substation_Name":"C","substation_id":"CI_3-3"},
 {"name":"CI_4","CI_OPERATOR":"Infrastructure_4","ci_sector":"Critical Manufacturing","ci_subsector":"D","init":false,"location_latitude":34.0,"location_longtitude":34.0,"maxPath":true,"substation_Name":"D","substation_id":"CI_4-4"},
 {"name":"CI_5","CI_OPERATOR":"Infrastructure_5","ci_sector":"Critical Manufacturing","ci_subsector":"E","init":false,"location_latitude":34.0,"location_longtitude":34.0,"maxPath":true,"substation_Name":"E","substation_id":"CI_5-5"},
 {"name":"CI_6","CI_OPERATOR":"Infrastructure_6","ci_sector":"Critical Manufacturing","ci_subsector":"F","init":false,"location_latitude":34.0,"location_longtitude":34.0,"maxPath":true,"substation_Name":"F","substation_id":"CI_6-6"},
 {"name":"CI_7","CI_OPERATOR":"Infrastructure_7","ci_sector":"Critical Manufacturing","ci_subsector":"G","init":false,"location_latitude":34.0,"location_longtitude":34.0,"maxPath":true,"substation_Name":"G","substation_id":"CI_7-7"},
 {"name":"CI_8","CI_OPERATOR":"Infrastructure_8","ci_sector":"Critical Manufacturing","ci_subsector":"H","init":false,"location_latitude":34.0,"location_longtitude":34.0,"maxPath":false,"substation_Name":"H","substation_id":"CI_8-8"},
 {"name":"CI_9","CI_OPERATOR":"Infrastructure_9","ci_sector":"Critical Manufacturing","ci_subsector":"I","init":false,"location_latitude":34.0,"location_longtitude":34.0,"maxPath":false,"substation_Name":"I","substation_id":"CI_9-9"}
],
"edges":[ 
 {"Risk_0":"3.24","Risk_1":"5.04","Risk_2":"6.84","Risk_3":"7.2","Risk_4":"7.2","Risk_5":"7.2","Risk_6":"7.2","Risk_7":"7.2","Risk_8":"7.2","Risk_9":"7.2","cRisk":1.08,"impact":[3.6,5.6,7.6,8.0,8.0,8.0,8.0,8.0,8.0,8.0],"inverseRisk_0":-3.24,"inverseRisk_1":-5.04,"inverseRisk_2":-6.84,"inverseRisk_3":-7.2,"inverseRisk_4":-7.2,"inverseRisk_5":-7.2,"inverseRisk_6":-7.2,"inverseRisk_7":-7.2,"inverseRisk_8":-7.2,"inverseRisk_9":-7.2,"isActive":1,"likelihood":0.9,"maxPath":true,"source":0,"target":4,"timeslot":9},
 {"Risk_0":"2.8","Risk_1":"4.48","Risk_2":"4.48","Risk_3":"4.8","Risk_4":"4.8","Risk_5":"4.8","Risk_6":"4.8","Risk_7":"4.8","Risk_8":"4.8","Risk_9":"4.8","cRisk":0.72,"impact":[3.5,5.6,5.6,6.0,6.0,6.0,6.0,6.0,6.0,6.0],"inverseRisk_0":-2.8,"inverseRisk_1":-4.48,"inverseRisk_2":-4.48,"inverseRisk_3":-4.8,"inverseRisk_4":-4.8,"inverseRisk_5":-4.8,"inverseRisk_6":-4.8,"inverseRisk_7":-4.8,"inverseRisk_8":-4.8,"inverseRisk_9":-4.8,"isActive":1,"likelihood":0.8,"maxPath":false,"source":0,"target":7,"timeslot":9},
 {"Risk_0":"3.24","Risk_1":"5.04","Risk_2":"6.84","Risk_3":"5.04","Risk_4":"7.2","Risk_5":"7.2","Risk_6":"7.2","Risk_7":"7.2","Risk_8":"7.2","Risk_9":"7.2","cRisk":1.08,"impact":[3.6,5.6,7.6,5.6,8.0,8.0,8.0,8.0,8.0,8.0],"inverseRisk_0":-3.24,"inverseRisk_1":-5.04,"inverseRisk_2":-6.84,"inverseRisk_3":-5.04,"inverseRisk_4":-7.2,"inverseRisk_5":-7.2,"inverseRisk_6":-7.2,"inverseRisk_7":-7.2,"inverseRisk_8":-7.2,"inverseRisk_9":-7.2,"isActive":1,"likelihood":0.9,"maxPath":false,"source":0,"target":1,"timeslot":9},
 {"Risk_0":"0.65","Risk_1":"0.65","Risk_2":"0.65","Risk_3":"2.41","Risk_4":"2.41","Risk_5":"3.9","Risk_6":"3.9","Risk_7":"3.9","Risk_8":"3.9","Risk_9":"3.9","cRisk":0.5265000000000001,"impact":[1.0,1.0,1.0,3.7,3.7,6.0,6.0,6.0,6.0,6.0],"inverseRisk_0":-0.65,"inverseRisk_1":-0.65,"inverseRisk_2":-0.65,"inverseRisk_3":-2.41,"inverseRisk_4":-2.41,"inverseRisk_5":-3.9,"inverseRisk_6":-3.9,"inverseRisk_7":-3.9,"inverseRisk_8":-3.9,"inverseRisk_9":-3.9,"isActive":1,"likelihood":0.65,"maxPath":true,"source":1,"target":2,"timeslot":9},
 {"Risk_0":"0.7","Risk_1":"0.7","Risk_2":"0.7","Risk_3":"2.59","Risk_4":"2.59","Risk_5":"4.2","Risk_6":"4.2","Risk_7":"4.2","Risk_8":"4.2","Risk_9":"4.2","cRisk":4.199999999999999,"impact":[1.0,1.0,1.0,3.7,3.7,6.0,6.0,6.0,6.0,6.0],"inverseRisk_0":-0.7,"inverseRisk_1":-0.7,"inverseRisk_2":-0.7,"inverseRisk_3":-2.59,"inverseRisk_4":-2.59,"inverseRisk_5":-4.2,"inverseRisk_6":-4.2,"inverseRisk_7":-4.2,"inverseRisk_8":-4.2,"inverseRisk_9":-4.2,"isActive":1,"likelihood":0.7,"maxPath":true,"source":2,"target":3,"timeslot":9},
 {"Risk_0":"0.15","Risk_1":"0.15","Risk_2":"0.15","Risk_3":"0.15","Risk_4":"0.15","Risk_5":"0.15","Risk_6":"0.45","Risk_7":"0.45","Risk_8":"0.45","Risk_9":"0.45","cRisk":0.44999999999999996,"impact":[1.0,1.0,1.0,1.0,1.0,1.0,3.0,3.0,3.0,3.0],"inverseRisk_0":-0.15,"inverseRisk_1":-0.15,"inverseRisk_2":-0.15,"inverseRisk_3":-0.15,"inverseRisk_4":-0.15,"inverseRisk_5":-0.15,"inverseRisk_6":-0.45,"inverseRisk_7":-0.45,"inverseRisk_8":-0.45,"inverseRisk_9":-0.45,"isActive":1,"likelihood":0.15,"maxPath":true,"source":3,"target":0,"timeslot":9},
 {"Risk_0":"0.7","Risk_1":"0.7","Risk_2":"0.7","Risk_3":"2.52","Risk_4":"3.5","Risk_5":"3.5","Risk_6":"3.5","Risk_7":"3.5","Risk_8":"3.5","Risk_9":"3.5","cRisk":3.5,"impact":[1.0,1.0,1.0,3.6,5.0,5.0,5.0,5.0,5.0,5.0],"inverseRisk_0":-0.7,"inverseRisk_1":-0.7,"inverseRisk_2":-0.7,"inverseRisk_3":-2.52,"inverseRisk_4":-3.5,"inverseRisk_5":-3.5,"inverseRisk_6":-3.5,"inverseRisk_7":-3.5,"inverseRisk_8":-3.5,"inverseRisk_9":-3.5,"isActive":1,"likelihood":0.7,"maxPath":true,"source":4,"target":5,"timeslot":9},
 {"Risk_0":"0.25","Risk_1":"0.25","Risk_2":"0.25","Risk_3":"0.25","Risk_4":"0.25","Risk_5":"0.95","Risk_6":"2.0","Risk_7":"2.0","Risk_8":"2.0","Risk_9":"2.0","cRisk":2.0,"impact":[1.0,1.0,1.0,1.0,1.0,3.8,8.0,8.0,8.0,8.0],"inverseRisk_0":-0.25,"inverseRisk_1":-0.25,"inverseRisk_2":-0.25,"inverseRisk_3":-0.25,"inverseRisk_4":-0.25,"inverseRisk_5":-0.95,"inverseRisk_6":-2.0,"inverseRisk_7":-2.0,"inverseRisk_8":-2.0,"inverseRisk_9":-2.0,"isActive":1,"likelihood":0.25,"maxPath":true,"source":5,"target":6,"timeslot":9},
 {"Risk_0":"0.65","Risk_1":"0.65","Risk_2":"0.65","Risk_3":"2.41","Risk_4":"3.71","Risk_5":"4.55","Risk_6":"4.55","Risk_7":"4.55","Risk_8":"4.55","Risk_9":"4.55","cRisk":4.55,"impact":[1.0,1.0,1.0,3.7,5.7,7.0,7.0,7.0,7.0,7.0],"inverseRisk_0":-0.65,"inverseRisk_1":-0.65,"inverseRisk_2":-0.65,"inverseRisk_3":-2.41,"inverseRisk_4":-3.71,"inverseRisk_5":-4.55,"inverseRisk_6":-4.55,"inverseRisk_7":-4.55,"inverseRisk_8":-4.55,"inverseRisk_9":-4.55,"isActive":1,"likelihood":0.65,"maxPath":false,"source":7,"target":8,"timeslot":9}
] 
 };

 
    var svg = d3.select("body").append("svg").attr({"width":w,"height":h});

    var force = d3.layout.force()
        .nodes(dataset.nodes)
        .links(dataset.edges)
        .size([w,h])
        .linkDistance([linkDistance])
        .charge([-500])
        .theta(0.1)
        .gravity(0.05)
        .start();

 

    var edges = svg.selectAll("line")
      .data(dataset.edges)
      .enter()
      .append("line")
      .attr("id",function(d,i) {return 'edge'+i})
      .attr('marker-end','url(#arrowhead)')
      .style("stroke","#ccc")
      .style("pointer-events", "none");
    
    var nodes = svg.selectAll("circle")
      .data(dataset.nodes)
      .enter()
      .append("circle")
      .attr({"r":15})
      .style("fill",function(d,i){return colors(i);})
      .call(force.drag)


    var nodelabels = svg.selectAll(".nodelabel") 
       .data(dataset.nodes)
       .enter()
       .append("text")
       .attr({"x":function(d){return d.x;},
              "y":function(d){return d.y;},
              "class":"nodelabel",
              "stroke":"black"})
       .text(function(d){return d.name;});

    var edgepaths = svg.selectAll(".edgepath")
        .data(dataset.edges)
        .enter()
        .append('path')
        .attr({'d': function(d) {return 'M '+d.source.x+' '+d.source.y+' L '+ d.target.x +' '+d.target.y},
               'class':'edgepath',
               'fill-opacity':0,
               'stroke-opacity':0,
               'fill':'blue',
               'stroke':'red',
               'id':function(d,i) {return 'edgepath'+i}})
        .style("pointer-events", "none");

    var edgelabels = svg.selectAll(".edgelabel")
        .data(dataset.edges)
        .enter()
        .append('text')
        .style("pointer-events", "none")
        .attr({'class':'edgelabel',
               'id':function(d,i){return 'edgelabel'+i},
               'dx':80,
               'dy':0,
               'font-size':10,
               'fill':'#aaa'});

    edgelabels.append('textPath')
        .attr('xlink:href',function(d,i) {return '#edgepath'+i})
        .style("pointer-events", "none")
        .text(function(d,i){return 'Risk=' + d.cRisk});


    svg.append('defs').append('marker')
        .attr({'id':'arrowhead',
               'viewBox':'-0 -5 10 10',
               'refX':25,
               'refY':0,
               //'markerUnits':'strokeWidth',
               'orient':'auto',
               'markerWidth':10,
               'markerHeight':10,
               'xoverflow':'visible'})
        .append('svg:path')
            .attr('d', 'M 0,-5 L 10 ,0 L 0,5')
            .attr('fill', '#ccc')
            .attr('stroke','#ccc');
     

    force.on("tick", function(){

        edges.attr({"x1": function(d){return d.source.x;},
                    "y1": function(d){return d.source.y;},
                    "x2": function(d){return d.target.x;},
                    "y2": function(d){return d.target.y;}
        });

        nodes.attr({"cx":function(d){return d.x;},
                    "cy":function(d){return d.y;}
        });

        nodelabels.attr("x", function(d) { return d.x; }) 
                  .attr("y", function(d) { return d.y; });

        edgepaths.attr('d', function(d) { var path='M '+d.source.x+' '+d.source.y+' L '+ d.target.x +' '+d.target.y;
                                           //console.log(d)
                                           return path});       

        edgelabels.attr('transform',function(d,i){
            if (d.target.x<d.source.x){
                bbox = this.getBBox();
                rx = bbox.x+bbox.width/2;
                ry = bbox.y+bbox.height/2;
                return 'rotate(180 '+rx+' '+ry+')';
                }
            else {
                return 'rotate(0)';
                }
        });
    });

</script>

</body>
</html>
